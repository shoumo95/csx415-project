---
title: "Model Performance - linear"
author:
  - name: Hakan Egeli
  - name: Soumyendu Sarkar
date: 'April 24, 2018'
knit: (function(inputFile, encoding) { 
      rmarkdown::render(inputFile,
                        encoding=encoding, 
                        output_file=file.path(dirname(inputFile), '../docs/', 'model-performance-linear-v2.html')) })
output: html_document
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, root.dir = "..")
```


```{r, echo=FALSE, include = FALSE}

cwd <- getwd()

# load the project. This will autoload the data and also create training and test datasets
setwd("..")
library('ProjectTemplate')
load.project()

setwd(cwd)

```

```{r, echo=FALSE}

library(nnet)

```

# Model After Backward Elimitaion Process

## Regression Models

```{r, echo=FALSE, warning=FALSE}

control <- trainControl(method="repeatedcv", number=5, repeats=1)

model_glm_naive <- train(CreditLimit ~ SalesLastYr, data=dataset_train, method="glm", metric="RMSE", trControl=control)

```

```{r, echo=FALSE, warning=FALSE}

control <- trainControl(method="repeatedcv", number=5, repeats=1)

model_glm_int <- train(CreditLimit ~ SalesCurrentYr + SalesLastYr + DesignBandSalesLast12Mo + NumberOfStoreLocations + AvgDaysOfPayCategory + ReturnedPaymentCount + RuralUrbanContinuumCode + MetroIndicator + MedianEarnings + MedianIncomeHouseholds, data=dataset_train, method="glm", metric="RMSE", trControl=control)

```

```{r, echo=FALSE, warning=FALSE}

model_glm <- train(CreditLimit ~ SalesCurrentYr + SalesLastYr + DesignBandSalesLast12Mo + NumberOfStoreLocations + AvgDaysOfPayCategory + ReturnedPaymentCount + RuralUrbanContinuumCode + MetroIndicator + MedianEarnings + MedianIncomeHouseholds - 1, data=dataset_train, method="glm", metric="RMSE", trControl=control)

```


```{r, echo=FALSE, warning=FALSE}

metric.regression.create <- function(){
  setNames(data.frame(matrix(ncol = 4, nrow = 0)), c("RMSE", "RMSESD", "Rsquared", "RsquaredSD"))
}

metric.regression.append <- function(df, model, row_name){
  df_tmp <- metric.regression.create()
  df_tmp <- bind_rows(df_tmp, c(RMSE=mean(model$resample[["RMSE"]]),
                                RMSESD=sd(model$resample[["RMSE"]]),
                                Rsquared=mean(model$resample[["Rsquared"]]),
                                RsquaredSD=sd(model$resample[["Rsquared"]])))
  rownames(df_tmp) <- c(row_name)
  rbind(df, df_tmp)
}

df <- metric.regression.create()
df <- metric.regression.append(df, model_glm_naive, "glm naive")
df <- metric.regression.append(df, model_glm_int, "glm w/ intercept")
df <- metric.regression.append(df, model_glm, "glm w/o intercept")

df

```

## Regression Tests Accuracy

```{r, warning=FALSE}

predictions <- predict(model_glm, newdata=dataset_test)
postResample(dataset_test$CreditLimit, predictions)

```


## Classification Models

```{r, echo=FALSE, warning=FALSE}

control <- trainControl(method="repeatedcv", number=5, repeats=1)

model_lda <- train(CreditLimitCategory ~ SalesCurrentYr + SalesLastYr + DesignBandSalesLast12Mo + NumberOfStoreLocations + AvgDaysOfPayCategory + ReturnedPaymentCount + RuralUrbanContinuumCode + MetroIndicator + MedianEarnings + MedianIncomeHouseholds - 1, data=dataset_train, method="lda", metric="Accuracy", trControl=control)

```

```{r, echo=FALSE, warning=FALSE}

model_svmRad <- train(CreditLimitCategory ~ SalesCurrentYr + SalesLastYr + DesignBandSalesLast12Mo + NumberOfStoreLocations + AvgDaysOfPayCategory + ReturnedPaymentCount + RuralUrbanContinuumCode + MetroIndicator + MedianEarnings + MedianIncomeHouseholds - 1, data=dataset_train, method="svmRadial", metric="Accuracy", trControl=control)

```

```{r, echo=FALSE, warning=FALSE}

#model_glmLogit <- train(CreditLimitCategory ~ SalesCurrentYr + SalesLastYr + DesignBandSalesLast12Mo + NumberOfStoreLocations + AvgDaysOfPayCategory + ReturnedPaymentCount + RuralUrbanContinuumCode + MetroIndicator + MedianEarnings + MedianIncomeHouseholds - 1, data=dataset_train, method="glm", metric="Accuracy", preProcess=c("center", "scale"), trControl=control)

```

```{r, echo=FALSE, warning=FALSE}

model_rpart <- train(CreditLimitCategory ~ SalesCurrentYr + SalesLastYr + DesignBandSalesLast12Mo + NumberOfStoreLocations + AvgDaysOfPayCategory + ReturnedPaymentCount + RuralUrbanContinuumCode + MetroIndicator + MedianEarnings + MedianIncomeHouseholds - 1, data=dataset_train, method="rpart", metric="Accuracy", trControl=control)

```


```{r, echo=FALSE, warning=FALSE}

control <- trainControl(method="repeatedcv", number=5, repeats=1, classProbs=TRUE)

model_multinom <- train(CreditLimitCategory ~ SalesCurrentYr + SalesLastYr + DesignBandSalesLast12Mo + NumberOfStoreLocations + AvgDaysOfPayCategory + ReturnedPaymentCount + RuralUrbanContinuumCode + MetroIndicator + MedianEarnings + MedianIncomeHouseholds - 1, data=dataset_train, method="multinom", metric="Accuracy", trControl=control, maxit=600, trace=FALSE)

```

```{r, echo=FALSE, warning=FALSE}

metric.classification.create <- function(){
  setNames(data.frame(matrix(ncol = 4, nrow = 0)), c("Accuracy", "AccuracySD", "Kappa", "KappaSD"))
}

metric.classification.append <- function(df, model, row_name){
  df_tmp <- metric.classification.create()
  df_tmp <- bind_rows(df_tmp, c(Accuracy=mean(model$resample[["Accuracy"]]),
                                AccuracySD=sd(model$resample[["Accuracy"]]),
                                Kappa=mean(model$resample[["Kappa"]]),
                                KappaSD=sd(model$resample[["Kappa"]])))
  rownames(df_tmp) <- c(row_name)
  rbind(df, df_tmp)
}

df <- metric.classification.create()
df <- metric.classification.append(df, model_rpart, "rpart")
df <- metric.classification.append(df, model_multinom, "multi")
df <- metric.classification.append(df, model_lda, "lda")
df <- metric.classification.append(df, model_svmRad, "svmRad")

df

```

## Classification Test Accuracy

```{r, warning=FALSE}

predictions <- predict(model_rpart, newdata=dataset_test)
postResample(dataset_test$CreditLimitCategory, predictions)
cm <- confusionMatrix(data=table(predictions, dataset_test$CreditLimitCategory))
cm$overall

```


```{r, warning=FALSE}

predictions <- predict(model_multinom, newdata=dataset_test)
postResample(dataset_test$CreditLimitCategory, predictions)
cm <- confusionMatrix(data=table(predictions, dataset_test$CreditLimitCategory))
cm$overall

```

